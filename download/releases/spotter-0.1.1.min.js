spotter={};spotter.Spotter=function(k,l){spotter.Spotter.instanceCount=(spotter.Spotter.instanceCount===undefined)?1:spotter.Spotter.instanceCount+1;var f="so"+spotter.Spotter.instanceCount;var m=false;var h=true;var i=null;var g=[];var a=null;var b;window.spotter[f]=this;if(!spotter.modules[k.split(".")[0]]||!spotter.modules[k.split(".")[0]][k.split(".")[1]]){throw new Error("Spotter: Module "+k+" not found! (Did you remember to include it via a script tag?)")}try{b=new (window.spotter["modules"][k.split(".")[0]][k.split(".")[1]])(l)}catch(j){throw new Error(j)}if(!b.url||!b.process){throw new Error("Spotter: spotter.modules."+k+" is invalid.  (Does it return an object with url and process methods?)")}this.spot=function(){if(!m){m=true}var e;var n=this;if(h){e=b.url();if(e instanceof Object&&e.callbackParam!==undefined){e=e.url+"&"+e.callbackParam+"=spotter."+f+".callback"}else{e+="&callback=spotter."+f+".callback"}e+="&random="+Math.floor(Math.random()*10000);d(e)}if(b.nextTimeout()>0){a=setTimeout(function(){n.spot()},b.nextTimeout()*1000)}};this.callback=function(n){var e=b.process(n);if(e.update){c(e.data)}h=true};this.stop=function(){if(!m){throw new Error("Spotter: You can't stop a stopped spotter!")}else{m=false;var e=document.getElementsByTagName("head");if(i!==null){e[0].removeChild(i)}clearTimeout(a)}};var d=function(n){var o=document.getElementsByTagName("head");var e=document.createElement("script");e.id=f+"_request";e.type="text/javascript";e.src=n;if(i!==null){o[0].removeChild(i)}o[0].appendChild(e);i=e};this.register=function(e){if(e.notify!==undefined&&typeof e.notify==="function"){g.push(e)}else{throw new TypeError("Observer must implement a notify method.")}};var c=function(n){for(var e in g){g[e].notify(n)}}};spotter.modules={};spotter.modules.Module=function(a){if(a.frequency===undefined){frequency=45}else{frequency=a.frequency}this.nextTimeout=function(){return frequency}};spotter.modules.flickr={};spotter.modules.flickr.search=function(c){spotter.modules.Module.call(this,c);if(c==undefined||c.api_key==undefined||(c.searchString==undefined&&c.tags==undefined)){throw new Error("flickr module requires an api_key and a searchString or tags to be defined as an option")}var f=c.api_key;var b=c.searchString;var a=c.tags;var e={id:-1};this.url=function(){var g="http://api.flickr.com/services/rest/?method=flickr.photos.search";g+="&api_key="+f+"&format=json&content_type=1";if(a!=undefined){g+="&tags="+escape(a)}if(b!=undefined){g+="&text="+escape(b)}return{url:g,callbackParam:"jsoncallback"}};this.process=function(k){var g={};g.data=[];var j=k.photos.photo;var h;for(h=0;h<j.length&&j[h].id!==e.id;h++){j[h].url=d(j[h]);j[h].user_url="http://www.flickr.com/"+j[h].owner;g.data.push(j[h])}e=j[0];g.update=(g.data.length>0)?true:false;return g};var d=function(h){var g="http://farm"+h.farm+".static.flickr.com/"+h.server+"/"+h.id+"_"+h.secret+".jpg";return g}};spotter.modules.twitpic={};spotter.modules.twitpic.search=function(c){spotter.modules.Module.call(this,c);var b="";var a=c.searchString;if(a===undefined||a===""){throw new Error("twitpic search module requires searchString to be specified as an option")}this.url=function(){var d="http://search.twitter.com/search.json";d+=b!=""?b:"?q="+escape(a)+"+twitpic";return d};this.process=function(h){var e={};var f;var g;var d;b=h.refresh_url;e.update=(h.results.length>0)?true:false;e.data=[];for(f in h.results){g=/http\:\/\/twitpic.com\/(\w+)/.exec(h.results[f].text);if(g!==null&&!h.results[f].text.match(new RegExp("^RT"))){d=g[1];h.results[f].twitpic_url="http://twitpic.com/"+d;h.results[f].twitpic_full_url="http://twitpic.com/show/full/"+d;h.results[f].twitpic_thumb_url="http://twitpic.com/show/thumb/"+d;h.results[f].twitpic_mini_url="http://twitpic.com/show/mini/"+d;e.data.push(h.results[f])}}return e}};spotter.modules.twitter={};spotter.modules.twitter.search=function(c){spotter.modules.Module.call(this,c);var b="";var a=c.searchString;if(a===undefined||a===""){throw new Error("twitter search module requires searchString to be specified as an option")}if(!frequency){frequency=MAX_FREQUENCY}this.url=function(){var d="http://search.twitter.com/search.json";d+=(b!=="")?b:"?q="+escape(a);return d};this.process=function(e){var d={};b=e.refresh_url;d.update=(e.results.length>0)?true:false;d.data=e.results;return d}};spotter.modules.twitter.trends=function(a){spotter.modules.Module.call(this,a);var b;this.url=function(){var c="http://search.twitter.com/trends.json?";if(a!=undefined&&a.exclude!=undefined){c+="exclude="+a.exclude}return c};this.process=function(f){var c={};var e=f.trends;if(b===null){c={data:{added:f.trends,removed:{},trends:f.trends}}}else{var d=spotter.util.complements(f.trends,b);c={data:{added:d[0],removed:d[1],trends:f.trends}}}b=f.trends;c.update=(c.data.added.length>0||c.data.removed.length>0)?true:false;return c}};spotter.util={};spotter.util.changes=function(e,d){var c=new Array();var g=new Object();for(var f in d){g[d[f]]==undefined?g[d[f]["name"]]=parseInt(f):null}for(var f in e){c[f]=g[e[f]["name"]]==undefined?-1:g[e[f]["name"]]}return c};spotter.util.complements=function(d,c){var h=new Object();var l=new Array();var m=new Array();for(var g in d){h[d[g]]==undefined?h[d[g]["name"]]=g:null}for(var f in c){h[c[f]["name"]]==null?m.push(c[f]):h[c[f]["name"]]=-1}for(var e in h){h[e]>=0?l.push(d[h[e]]):null}return[l,m]};