if(!window.com){window.com={}}if(!com.yellowsocket){com.yellowsocket={}}com.yellowsocket.spotter={};com.yellowsocket.spotter.Spotter=function(k,l){com.yellowsocket.spotter.Spotter.instanceCount=(com.yellowsocket.spotter.Spotter.instanceCount===undefined)?1:com.yellowsocket.spotter.Spotter.instanceCount+1;var f="so"+com.yellowsocket.spotter.Spotter.instanceCount;var m=false;var h=true;var i=null;var g=[];var a=null;var b;window.com["yellowsocket"]["spotter"][f]=this;if(!com.yellowsocket.spotter.modules[k.split(".")[0]]||!com.yellowsocket.spotter.modules[k.split(".")[0]][k.split(".")[1]]){throw new Error("Spotter: Module "+k+" not found! (Did you remember to include it via a script tag?)")}try{b=new (window.com["yellowsocket"]["spotter"]["modules"][k.split(".")[0]][k.split(".")[1]])(l)}catch(j){throw new Error(j)}if(!b.url||!b.process){throw new Error("Spotter: com.yellowsocket.spotter.modules."+k+" is invalid.  (Does it return an object with url and process methods?)")}this.spot=function(){if(!m){m=true}var e;var n=this;if(h){e=b.url();if(e instanceof Object&&e.callbackParam!==undefined){e=e.url+"&"+e.callbackParam+"=com.yellowsocket.spotter."+f+".callback"}else{e+="&callback=com.yellowsocket.spotter."+f+".callback"}e+="&random="+Math.floor(Math.random()*10000);d(e)}if(b.nextTimeout()>0){a=setTimeout(function(){n.spot()},b.nextTimeout()*1000)}};this.callback=function(n){var e=b.process(n);if(e.update){c(e.data)}h=true};this.stop=function(){if(!m){throw new Error("Spotter: You can't stop a stopped spotter!")}else{m=false;var e=document.getElementsByTagName("head");if(i!==null){e[0].removeChild(i)}clearTimeout(a)}};var d=function(n){var o=document.getElementsByTagName("head");var e=document.createElement("script");e.id=f+"_request";e.type="text/javascript";e.src=n;if(i!==null){o[0].removeChild(i)}o[0].appendChild(e);i=e};this.register=function(e){if(e!==undefined&&e.notify!==undefined&&typeof e.notify==="function"){g.push(e)}else{if(e!==undefined&&typeof e==="function"){g.push(e)}else{throw new TypeError("Observer must implement a notify method.")}}};var c=function(n){for(var e in g){if(typeof g[e]==="object"){g[e].notify(n)}else{if(typeof g[e]==="function"){g[e](n)}else{throw new Error("observer list contains an invalid object")}}}}};com.yellowsocket.spotter.modules={};com.yellowsocket.spotter.modules.Module=function(a){var b;if(a.period===undefined){b=45}else{b=a.period}this.nextTimeout=function(){return b}};if(!com.yellowsocket.spotter.modules.delicious){com.yellowsocket.spotter.modules.delicious={}}else{if(typeof com.yellowsocket.spotter.modules.delicious!="object"){throw new Error("com.yellowsocket.spotter.modules.delicious is not an object!")}}com.yellowsocket.spotter.modules.delicious.recent=function(a){com.yellowsocket.spotter.modules.Module.call(this,a);var b;this.url=function(){var d="http://feeds.delicious.com/v2/json/recent/?count=100";return d};this.process=function(f){var d={};if(b===undefined){b=f[0];d={data:f,update:true}}else{if(b.u===f[0]["u"]){d={data:f,update:false}}else{pops=f.length-c(b,f);for(var e=0;e<pops;e++){f.pop()}d={data:f,update:true};b=f[0]}}return d};var c=function(e,f){for(var d=0;d<f.length;++d){if(f[d]["u"]===e.u){return d}}return f.length}};com.yellowsocket.spotter.modules.delicious.tags=function(b){spotter.modules.Module.call(this,b);var a=b.tags;if(a===undefined||a===""){throw new Error("delicious tags module requires tags to be specified as an option")}var c;this.url=function(){var e="http://feeds.delicious.com/v2/json/tag/"+a+"?count=100";return e};this.process=function(g){var e={};if(c===undefined){c=g[0];e={data:g,update:true}}else{if(c.u===g[0]["u"]){e={data:g,update:false}}else{pops=g.length-d(c,g);for(var f=0;f<pops;f++){g.pop()}e={data:g,update:true};c=g[0]}}return e};var d=function(f,g){for(var e=0;e<g.length;++e){if(g[e]["u"]===f.u){return e}}return g.length}};if(!com.yellowsocket.spotter.modules.facebook){com.yellowsocket.spotter.modules.facebook={}}else{if(typeof com.yellowsocket.spotter.modules.facebook!="object"){throw new Error("com.yellowsocket.spotter.modules.facebook is not an object!")}}com.yellowsocket.spotter.modules.facebook.search=function(c){com.yellowsocket.spotter.modules.Module.call(this,c);var b=c.q;var a=null;var d;if(b===undefined||b===""){throw new Error("facebook search module requires a search string (q) to be specified as an option")}this.url=function(){var e="http://graph.facebook.com/search";e+="?q="+escape(b);return e};this.process=function(f){var e={};e.data=[];for(d in f.data){if((a===null||f.data[d].created_time>a)&&f.data[d].type==="status"){f.data[d].profile_image_url="http://graph.facebook.com/"+f.data[d].from.id+"/picture";f.data[d].profile_url="http://www.facebook.com/people/"+f.data[d].from.name.replace(" ","-")+"/"+f.data[d].from.id;e.data.push(f.data[d])}else{}}a=f.data[0]["created_time"];e.update=(e.data.length>0)?true:false;return e}};if(!com.yellowsocket.spotter.modules.flickr){com.yellowsocket.spotter.modules.flickr={}}else{if(typeof com.yellowsocket.spotter.modules.flickr!="object"){throw new Error("com.yellowsocket.spotter.modules.flickr is not an object!")}}com.yellowsocket.spotter.modules.flickr.search=function(c){com.yellowsocket.spotter.modules.Module.call(this,c);if(c==undefined||c.api_key==undefined||(c.q==undefined&&c.tags==undefined)){throw new Error("flickr search module requires an api_key and a search string (q) or tags to be defined as an option")}var f=c.api_key;var b=c.q;var a=c.tags;var e={id:-1};this.url=function(){var g="http://api.flickr.com/services/rest/?method=flickr.photos.search";g+="&api_key="+f+"&format=json&content_type=1";if(a!=undefined){g+="&tags="+escape(a)}if(b!=undefined){g+="&text="+escape(b)}return{url:g,callbackParam:"jsoncallback"}};this.process=function(k){var g={};g.data=[];var j=k.photos.photo;var h;for(h=0;h<j.length&&j[h].id!==e.id;h++){j[h].url=d(j[h]);j[h].user_url="http://www.flickr.com/"+j[h].owner;j[h].photo_url="http://www.flickr.com/"+j[h].owner+"/"+j[h].id;g.data.push(j[h])}e=j[0];g.update=(g.data.length>0)?true:false;return g};var d=function(h){var g="http://farm"+h.farm+".static.flickr.com/"+h.server+"/"+h.id+"_"+h.secret+".jpg";return g}};com.yellowsocket.spotter.modules.flickr.feeds=function(b){com.yellowsocket.spotter.modules.Module.call(this,b);var a=b.tags||null;var c={id:-1};this.url=function(){var d="http://api.flickr.com/services/feeds/photos_public.gne?format=json";if(a!==null){d+="&tags="+escape(a)}return{url:d,callbackParam:"jsoncallback"}};this.process=function(g){var d={};d.data=[];var f=g.items;var e;for(e=0;e<f.length&&f[e].link!==c.link;e++){f[e].url=f[e].media.m.replace("_m","");f[e].user_url="http://www.flickr.com/"+f[e].author_id;f[e].photo_url=f[e].link;if(f[e].author.match(/\(([^\)]*)\)/)===null){alert(f[e].author)}f[e].user_id=f[e].author.match(/\(([^\)]*)\)/)[1];d.data.push(f[e])}c=f[0];d.update=(d.data.length>0)?true:false;return d}};if(!com.yellowsocket.spotter.modules.twitpic){com.yellowsocket.spotter.modules.twitpic={}}else{if(typeof com.yellowsocket.spotter.modules.twitpic!="object"){throw new Error("com.yellowsocket.spotter.modules.twitpic is not an object!")}}com.yellowsocket.spotter.modules.twitpic.search=function(c){com.yellowsocket.spotter.modules.Module.call(this,c);var b="";var a=c.q;if(a===undefined||a===""){throw new Error("twitpic search module requires a search string (q) to be specified as an option")}this.url=function(){var d="http://search.twitter.com/search.json";d+=b!=""?b:"?q="+escape(a)+"+twitpic";return d};this.process=function(h){var e={};var f;var g;var d;b=h.refresh_url||"";e.update=(h.results.length>0)?true:false;e.data=[];for(f in h.results){g=/http\:\/\/twitpic.com\/(\w+)/.exec(h.results[f].text);if(g!==null&&!h.results[f].text.match(new RegExp("^RT"))){d=g[1];h.results[f].twitpic_url="http://twitpic.com/"+d;h.results[f].twitpic_full_url="http://twitpic.com/show/full/"+d;h.results[f].twitpic_thumb_url="http://twitpic.com/show/thumb/"+d;h.results[f].twitpic_mini_url="http://twitpic.com/show/mini/"+d;e.data.push(h.results[f])}}return e}};if(!com.yellowsocket.spotter.modules.twitter){com.yellowsocket.spotter.modules.twitter={}}else{if(typeof com.yellowsocket.spotter.modules.twitter!="object"){throw new Error("com.yellowsocket.spotter.modules.twitter is not an object!")}}com.yellowsocket.spotter.modules.twitter.search=function(d){com.yellowsocket.spotter.modules.Module.call(this,d);var c="";var b=d.q;var a=(d.exclude!==undefined)?d.exclude.split(","):[];var g=d.lang;var f;var e="";if(b===undefined||b===""){throw new Error("twitter search module requires a search string (q) to be specified as an option")}if(a!==undefined){for(f=0;f<a.length;f++){if(a[f]==="twitpic"||a[f]==="tweetphoto"){e+=(e==="")?a[f]:"|"+a[f]}else{throw new Error(a[f]+" not a valid exclude string, try 'tweetphoto' and/or 'twitpic'")}}}this.url=function(){var h="http://search.twitter.com/search.json";h+=(c!=="")?c:"?q="+escape(b);h+=(g)?"&lang="+g:"";return h};this.process=function(j){var h={};c=j.refresh_url||"";if(e===""){h.data=j.results}else{h.data=[];var i=new RegExp(e);for(f in j.results){if(j.results[f].text.match(i)===null){h.data.push(j.results[f])}else{}}}h.update=(h.data.length>0)?true:false;return h}};com.yellowsocket.spotter.modules.twitter.trends=function(a){com.yellowsocket.spotter.modules.Module.call(this,a);var b;this.url=function(){var c="http://search.twitter.com/trends.json?";if(a!=undefined&&a.exclude!=undefined){c+="exclude="+a.exclude}return c};this.process=function(f){var c={};var e=f.trends;if(b===null){c={data:{added:f.trends,removed:{},trends:f.trends}}}else{var d=com.yellowsocket.spotter.util.complements(f.trends,b);c={data:{added:d[0],removed:d[1],trends:f.trends}}}b=f.trends;c.update=(c.data.added.length>0||c.data.removed.length>0)?true:false;return c}};com.yellowsocket.spotter.util={};com.yellowsocket.spotter.util.changes=function(e,d){var c=new Array();var g=new Object();for(var f in d){g[d[f]]==undefined?g[d[f]["name"]]=parseInt(f):null}for(var f in e){c[f]=g[e[f]["name"]]==undefined?-1:g[e[f]["name"]]}return c};com.yellowsocket.spotter.util.complements=function(d,c){var h=new Object();var l=new Array();var m=new Array();for(var g in d){h[d[g]]==undefined?h[d[g]["name"]]=g:null}for(var f in c){h[c[f]["name"]]==null?m.push(c[f]):h[c[f]["name"]]=-1}for(var e in h){h[e]>=0?l.push(d[h[e]]):null}return[l,m]};Spotter=com.yellowsocket.spotter.Spotter;