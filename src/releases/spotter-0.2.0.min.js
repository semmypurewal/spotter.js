(function(b){var a={};a.Spotter=function(m,n){a.Spotter.instanceCount=(a.Spotter.instanceCount===undefined)?1:a.Spotter.instanceCount+1;var h="_so"+a.Spotter.instanceCount;var o=false;var j=true;var k=null;var i=[];var c=null;var d;b.spotterjs[h]=this;if(!a.modules[m.split(".")[0]]||!a.modules[m.split(".")[0]][m.split(".")[1]]){throw new Error("Spotter: Module "+m+" not found! (Did you remember to include it via a script tag?)")}try{d=new (b.spotterjs["modules"][m.split(".")[0]][m.split(".")[1]])(n)}catch(l){throw new Error(l)}if(!d.url||!d.process){throw new Error("Spotter: spotterjs.modules."+m+" is invalid.  (Does it return an object with url and process methods?)")}a.Spotter.prototype.start=function(){if(!o){o=true}var e;var p=this;if(j){e=d.url();if(e instanceof Object&&e.callbackParam!==undefined){e=e.url+"&"+e.callbackParam+"=spotterjs."+h+".callback"}else{e+="&callback=spotterjs."+h+".callback"}e+="&random="+Math.floor(Math.random()*10000);g(e)}if(d.nextTimeout()>0){c=setTimeout(function(){p.start()},d.nextTimeout()*1000)}};a.Spotter.prototype.callback=function(p){var e=d.process(p);if(e.update){f(e.data)}j=true};a.Spotter.prototype.stop=function(){if(!o){throw new Error("Spotter: You can't stop a stopped spotter!")}else{o=false;var e=document.getElementsByTagName("head");if(k){e[0].removeChild(k)}clearTimeout(c)}};var g=function(p){var q=document.getElementsByTagName("head");var e=document.createElement("script");e.id=h+"_request";e.type="text/javascript";e.src=p;if(k){q[0].removeChild(k)}q[0].appendChild(e);k=e};a.Spotter.prototype.register=function(e){if(e!==undefined&&e.notify!==undefined&&typeof e.notify==="function"){i.push(e)}else{if(e!==undefined&&typeof e==="function"){i.push(e)}else{throw new TypeError("Observer must implement a notify method.")}}};var f=function(p){for(var e in i){if(typeof i[e]==="object"){i[e].notify(p)}else{if(typeof i[e]==="function"){i[e](p)}else{throw new Error("observer list contains an invalid object")}}}}};a.util={};a.util.changes=function(e,d){var c=new Array();var g=new Object();for(var f in d){g[d[f]]==undefined?g[d[f]["name"]]=parseInt(f):null}for(var f in e){c[f]=g[e[f]["name"]]==undefined?-1:g[e[f]["name"]]}return c};a.util.complements=function(d,c){var h=new Object();var l=new Array();var m=new Array();for(var g in d){h[d[g]]==undefined?h[d[g]["name"]]=g:null}for(var f in c){h[c[f]["name"]]==null?m.push(c[f]):h[c[f]["name"]]=-1}for(var e in h){h[e]>=0?l.push(d[h[e]]):null}return[l,m]};a.modules={};a.modules.Module=function(c){var d=c.period||c.timeout||45;this.nextTimeout=function(e){if(e){d=e}else{return d}}};if(!a.modules.delicious){a.modules.delicious={}}else{if(typeof a.modules.delicious!="object"){throw new Error("spotterjs.modules.delicious is not an object!")}}a.modules.delicious.recent=function(c){a.modules.Module.call(this,c);var d;this.url=function(){var f="http://feeds.delicious.com/v2/json/recent/?count=100";return f};this.process=function(h){var f={};if(d===undefined){d=h[0];f={data:h,update:true}}else{if(d.u===h[0]["u"]){f={data:h,update:false}}else{pops=h.length-e(d,h);for(var g=0;g<pops;g++){h.pop()}f={data:h,update:true};d=h[0]}}return f};var e=function(g,h){for(var f=0;f<h.length;++f){if(h[f]["u"]===g.u){return f}}return h.length}};a.modules.delicious.tags=function(d){a.modules.Module.call(this,d);var c=d.tags;if(c===undefined||c===""){throw new Error("delicious tags module requires tags to be specified as an option")}var e;this.url=function(){var g="http://feeds.delicious.com/v2/json/tag/"+c+"?count=100";return g};this.process=function(j){var g={};if(e===undefined){e=j[0];g={data:j,update:true}}else{if(e.u===j[0]["u"]){g={data:j,update:false}}else{pops=j.length-f(e,j);for(var h=0;h<pops;h++){j.pop()}g={data:j,update:true};e=j[0]}}return g};var f=function(h,j){for(var g=0;g<j.length;++g){if(j[g]["u"]===h.u){return g}}return j.length}};if(!a.modules.flickr){a.modules.flickr={}}else{if(typeof a.modules.flickr!="object"){throw new Error("spotterjs.modules.flickr is not an object!")}}a.modules.flickr.search=function(e){a.modules.Module.call(this,e);if(e==undefined||e.api_key==undefined||(e.q==undefined&&e.tags==undefined)){throw new Error("flickr search module requires an api_key and a search string (q) or tags to be defined as an option")}var h=e.api_key;var d=e.q;var c=e.tags;var g={id:-1};this.url=function(){var i="http://api.flickr.com/services/rest/?method=flickr.photos.search";i+="&api_key="+h+"&format=json&content_type=1";if(c!=undefined){i+="&tags="+escape(c)}if(d!=undefined){i+="&text="+escape(d)}return{url:i,callbackParam:"jsoncallback"}};this.process=function(m){var j={};j.data=[];var l=m.photos.photo;var k;for(k=0;k<l.length&&l[k].id!==g.id;k++){l[k].url=f(l[k]);l[k].user_url="http://www.flickr.com/"+l[k].owner;l[k].photo_url="http://www.flickr.com/"+l[k].owner+"/"+l[k].id;j.data.push(l[k])}g=l[0];j.update=(j.data.length>0)?true:false;return j};var f=function(j){var i="http://farm"+j.farm+".static.flickr.com/"+j.server+"/"+j.id+"_"+j.secret+".jpg";return i}};a.modules.flickr.feeds=function(d){a.modules.Module.call(this,d);var c=d.tags||null;var e={id:-1};this.url=function(){var f="http://api.flickr.com/services/feeds/photos_public.gne?format=json";if(c!==null){f+="&tags="+escape(c)}return{url:f,callbackParam:"jsoncallback"}};this.process=function(j){var f={};f.data=[];var h=j.items;var g;for(g=0;g<h.length&&h[g].link!==e.link;g++){h[g].url=h[g].media.m.replace("_m","");h[g].user_url="http://www.flickr.com/"+h[g].author_id;h[g].photo_url=h[g].link;if(h[g].author.match(/\(([^\)]*)\)/)===null){alert(h[g].author)}h[g].user_id=h[g].author.match(/\(([^\)]*)\)/)[1];f.data.push(h[g])}e=h[0];f.update=(f.data.length>0)?true:false;return f}};if(!a.modules.twitter){a.modules.twitter={}}else{if(typeof a.modules.twitter!="object"){throw new Error("spotterjs.modules.twitter is not an object!")}}a.modules.twitter.search=function(f){a.modules.Module.call(this,f);var e="";var d=f.q;var c=(f.exclude!==undefined)?f.exclude.split(","):[];var j=f.lang;var h;var g="";if(d===undefined||d===""){throw new Error("twitter search module requires a search string (q) to be specified as an option")}if(c!==undefined){for(h=0;h<c.length;h++){if(c[h]==="twitpic"||c[h]==="tweetphoto"){g+=(g==="")?c[h]:"|"+c[h]}else{throw new Error(c[h]+" not a valid exclude string, try 'tweetphoto' and/or 'twitpic'")}}}this.url=function(){var i="http://search.twitter.com/search.json";i+=(e!=="")?e:"?q="+escape(d);i+=(j)?"&lang="+j:"";return i};this.process=function(l){var i={};e=l.refresh_url||"";if(g===""){i.data=l.results}else{i.data=[];var k=new RegExp(g);for(h in l.results){if(l.results[h].text.match(k)===null){i.data.push(l.results[h])}else{}}}i.update=(i.data.length>0)?true:false;return i}};a.modules.twitter.trends=function(c){a.modules.Module.call(this,c);var d;this.url=function(){var e="http://api.twitter.com/trends.json?";if(c!=undefined&&c.exclude!=undefined){e+="exclude="+c.exclude}return e};this.process=function(h){var e={};var g=h.trends;if(d===null){e={data:{added:h.trends,removed:{},trends:h.trends}}}else{var f=a.util.complements(h.trends,d);e={data:{added:f[0],removed:f[1],trends:h.trends}}}d=h.trends;e.update=(e.data.added.length>0||e.data.removed.length>0)?true:false;return e}};if(!a.modules.facebook){a.modules.facebook={}}else{if(typeof a.modules.facebook!="object"){throw new Error("spotterjs.modules.facebook is not an object!")}}a.modules.facebook.search=function(e){a.modules.Module.call(this,e);var d=e.q;var c=null;var f;if(d===undefined||d===""){throw new Error("facebook search module requires a search string (q) to be specified as an option")}this.url=function(){var g="http://graph.facebook.com/search";g+="?q="+escape(d);return g};this.process=function(h){var g={};g.data=[];for(f in h.data){if((c===null||h.data[f].created_time>c)&&h.data[f].type==="status"){h.data[f].profile_image_url="http://graph.facebook.com/"+h.data[f].from.id+"/picture";h.data[f].profile_url="http://www.facebook.com/people/"+h.data[f].from.name.replace(" ","-")+"/"+h.data[f].from.id;g.data.push(h.data[f])}else{}}c=h.data[0]["created_time"];g.update=(g.data.length>0)?true:false;return g}};if(!a.modules.twitpic){a.modules.twitpic={}}else{if(typeof a.modules.twitpic!="object"){throw new Error("spotterjs.modules.twitpic is not an object!")}}a.modules.twitpic.search=function(e){a.modules.Module.call(this,e);var d="";var c=e.q;if(c===undefined||c===""){throw new Error("twitpic search module requires a search string (q) to be specified as an option")}this.url=function(){var f="http://search.twitter.com/search.json";f+=d!=""?d:"?q="+escape(c)+"+twitpic";return f};this.process=function(k){var g={};var h;var j;var f;d=k.refresh_url||"";g.update=(k.results.length>0)?true:false;g.data=[];for(h in k.results){j=/http\:\/\/twitpic.com\/(\w+)/.exec(k.results[h].text);if(j!==null&&!k.results[h].text.match(new RegExp("^RT"))){f=j[1];k.results[h].twitpic_url="http://twitpic.com/"+f;k.results[h].twitpic_full_url="http://twitpic.com/show/full/"+f;k.results[h].twitpic_thumb_url="http://twitpic.com/show/thumb/"+f;k.results[h].twitpic_mini_url="http://twitpic.com/show/mini/"+f;g.data.push(k.results[h])}}return g}};b.spotterjs=a;b.Spotter=a.Spotter})(window);