Spotter.spotterFactory=function(){Spotter.instanceCount=Spotter.instanceCount==null?1:Spotter.instanceCount++;var variable_name="__SPOTTER_OBJECT_"+Spotter.instanceCount+Math.floor(Math.random()*100);var script=variable_name+' = new Spotter("'+variable_name+'");';return eval(script)};function Spotter(a){this.varName=a;this.refreshURL="";this.lastCallReturned=true;this.lastScriptTag=null;this.observers=new Array();this.lastTrends=null}Spotter.prototype.searchInterval=function(c,b){this.search(c);var a=this;this.intervalTImer=setInterval(function(){a.search(c)},b*1000)};Spotter.prototype.search=function(b){if(this.lastCallReturned){var a="http://search.twitter.com/search.json";a+=this.refreshURL!=""?this.refreshURL:"?q="+escape(b);a+="&callback="+this.varName+".searchCallBack";a+="&random="+Math.floor(Math.random()*10000);this.request(a)}};Spotter.prototype.searchCallBack=function(a){var b=a.results;this.refreshURL=a.refresh_url;if(b.length!=0){this.notifyObservers(b)}this.lastCallReturned=true};Spotter.prototype.trendsInterval=function(c,a){this.trends(a);var b=this;this.intervalTImer=setInterval(function(){b.trends(a)},c*1000)};Spotter.prototype.trends=function(b){if(this.lastCallReturned){var a="http://search.twitter.com/trends.json?";if(b!=undefined&&b.exclude!=undefined){a+="exclude="+b.exclude}a+="&callback="+this.varName+".trendsCallBack";this.request(a)}};Spotter.prototype.trendsCallBack=function(a){var d=a.trends;if(this.lastTrends==null){result={added:d,removed:{},trends:d}}else{var b=this.complements(d,this.lastTrends);var c=this.changes(d,this.lastTrends);result={added:b[0],removed:b[1],trends:d,changes:c}}this.lastTrends=d;if(result.added.length>0||result.removed.length>0){this.notifyObservers(result)}this.lastCallReturned=true};Spotter.prototype.registerObserver=function(a){if(a.notify!=undefined&&typeof a.notify=="function"){this.observers.push(a)}else{throw new TypeError("Spotter: observer must implement a notify method.")}};Spotter.prototype.notifyObservers=function(b){for(var a in this.observers){this.observers[a].notify(b)}};Spotter.prototype.changes=function(e,d){var c=new Array();var g=new Object();for(var f in d){g[d[f]]==undefined?g[d[f]["name"]]=parseInt(f):null}for(var f in e){c[f]=g[e[f]["name"]]==undefined?-1:g[e[f]["name"]]}return c};Spotter.prototype.complements=function(d,c){var h=new Object();var l=new Array();var m=new Array();for(var g in d){h[d[g]]==undefined?h[d[g]["name"]]=g:null}for(var f in c){h[c[f]["name"]]==null?m.push(c[f]):h[c[f]["name"]]=-1}for(var e in h){h[e]>=0?l.push(d[h[e]]):null}return[l,m]};Spotter.prototype.request=function(b){var c=document.getElementsByTagName("head");var a=document.createElement("script");a.id="spotter_search_request"+this.varName;a.type="text/javascript";a.src=b;if(this.lastScriptTag!=null){c[0].removeChild(this.lastScriptTag)}c[0].appendChild(a);this.lastScriptTag=a};