(function(b){var a={};a.Spotter=function(o,s){a.Spotter.instanceCount=(a.Spotter.instanceCount===undefined)?1:a.Spotter.instanceCount+1;var i="_so"+a.Spotter.instanceCount;var t=false;var k=true;var l=null;var j=[];var c=null;var d;var h=[];var q;var r;b.spotterjs[i]=this;if(!a.modules[o.split(".")[0]]||!a.modules[o.split(".")[0]][o.split(".")[1]]){throw new Error("Spotter: Module "+o+" not found! (Did you remember to include it via a script tag?)")}try{d=new (b.spotterjs.modules[o.split(".")[0]][o.split(".")[1]])(s)}catch(m){throw new Error(m)}if(!d.url||!d.process){throw new Error("Spotter: spotterjs.modules."+o+" is invalid.  (Does it return an object with url and process methods?)")}var g=function(u){var v=document.getElementsByTagName("head");var e=document.createElement("script");e.id=i+"_request";e.type="text/javascript";e.src=u;if(l){v[0].removeChild(l)}v[0].appendChild(e);l=e};var f=function(u){for(var e in j){if(typeof j[e]==="object"){j[e].notify(u)}else{if(typeof j[e]==="function"){j[e](u)}else{throw new Error("observer list contains an invalid object")}}}};var p=function(){if(h.length>0){r=setTimeout(function(){f(h.pop());p()},2000)}else{clearTimeout(r);r=false}};var n=function(){var e;var u=this;if(k){e=d.url();if(e instanceof Object&&e.callbackParam!==undefined){e=e.url+"&"+e.callbackParam+"=spotterjs."+i+".callback"}else{e+="&callback=spotterjs."+i+".callback"}e+="&random="+Math.floor(Math.random()*10000);g(e)}};this.start=function(){if(!t){t=true;n()}else{throw new Error("Spotter: You can't start a spotter that is already running!")}};this.bufferStart=function(){q=true;this.start()};this.callback=function(v){var e=d.process(v);var u;if(e.update){if(!q){f(e.data)}else{for(u=0;u<e.data.length;u++){h.push(e.data[u])}if(!r){p()}}}k=true;if(d.nextTimeout()>0){c=setTimeout(n,d.nextTimeout()*1000)}else{this.stop()}};this.stop=function(){if(!t){throw new Error("Spotter: You can't stop a stopped spotter!")}else{t=false;var e=document.getElementsByTagName("head");if(l){e[0].removeChild(l)}clearTimeout(c)}};this.register=function(e){if(e!==undefined&&e.notify!==undefined&&typeof e.notify==="function"){j.push(e)}else{if(e!==undefined&&typeof e==="function"){j.push(e)}else{throw new TypeError("Observer must implement a notify method.")}}}};a.util={};a.util.changes=function(e,d){var c=[];var g={};var f;for(f=0;f<d.length;f++){if(!g[d[f]]){g[d[f].name]=parseInt(f,10)}}for(f=0;f<e.length;f++){c[f]=g[e[f].name]===undefined?-1:g[e[f].name]}return c};a.util.complements=function(d,c){var h={};var l=[];var m=[];var g,f,e;for(g=0;g<d.length;g++){if(h[d[g]]===undefined){h[d[g].name]=g}}for(f=0;f<f.length;f++){if(h[c[f].name]===null){m.push(c[f])}else{h[c[f].name]=-1}}for(e in h){if(h[e]>=0){l.push(d[h[e]])}}return[l,m]};a.modules={};a.modules.Module=function(c){var d;if(c.period!==undefined&&typeof(c.period)==="number"){d=c.period}else{d=45}this.nextTimeout=function(e){if(e!==undefined){d=e}else{return d}}};b.spotterjs=a;b.Spotter=a.Spotter})(window);(function(b){var a=b.spotterjs;if(!a){throw new Error("spotterjs not yet loaded!")}if(!a.util){throw new Error("spotterjs.util not yet loaded!")}if(!a.modules){a.modules={}}else{if(typeof a.modules!="object"){throw new Error("spotterjs.modules is not an object!")}}if(!a.modules.delicious){a.modules.delicious={}}else{if(typeof a.modules.delicious!="object"){throw new Error("spotterjs.modules.delicious is not an object!")}}a.modules.delicious.recent=function(c){a.modules.Module.call(this,c);var e=function(g,h){for(var f=0;f<h.length;++f){if(h[f].u===g.u){return f}}return h.length};var d;this.url=function(){var f="http://feeds.delicious.com/v2/json/recent/?count=100";return f};this.process=function(h){var f={};var j;if(d===undefined){d=h[0];f={data:h,update:true}}else{if(d.u===h[0].u){f={data:h,update:false}}else{j=h.length-e(d,h);for(var g=0;g<j;g++){h.pop()}f={data:h,update:true};d=h[0]}}return f}};a.modules.delicious.tags=function(d){a.modules.Module.call(this,d);var c=d.tags;if(c===undefined||c===""){throw new Error("delicious tags module requires tags to be specified as an option")}var e;var f=function(h,j){for(var g=0;g<j.length;++g){if(j[g].u===h.u){return g}}return j.length};this.url=function(){var g="http://feeds.delicious.com/v2/json/tag/"+c+"?count=100";return g};this.process=function(j){var g={};var k;if(e===undefined){e=j[0];g={data:j,update:true}}else{if(e.u===j[0].u){g={data:j,update:false}}else{k=j.length-f(e,j);for(var h=0;h<k;h++){j.pop()}g={data:j,update:true};e=j[0]}}return g}}})(window);(function(b){var a=b.spotterjs;if(!a){throw new Error("spotter not yet loaded!")}if(!a.util){throw new Error("spotter.util not yet loaded!")}if(!a.modules){a.modules={}}else{if(typeof a.modules!="object"){throw new Error("spotterjs.modules is not an object!")}}if(!a.modules.facebook){a.modules.facebook={}}else{if(typeof a.modules.facebook!="object"){throw new Error("spotterjs.modules.facebook is not an object!")}}a.modules.facebook.search=function(e){a.modules.Module.call(this,e);var d=e.q;var c=null;var f;if(d===undefined||d===""){throw new Error("facebook search module requires a search string (q) to be specified as an option")}this.url=function(){var g="http://graph.facebook.com/search";g+="?q="+escape(d);return g};this.process=function(h){var g={};g.data=[];for(f in h.data){if((c===null||h.data[f].created_time>c)&&h.data[f].type==="status"){h.data[f].profile_image_url="http://graph.facebook.com/"+h.data[f].from.id+"/picture";h.data[f].profile_url="http://www.facebook.com/people/"+h.data[f].from.name.replace(" ","-")+"/"+h.data[f].from.id;g.data.push(h.data[f])}}c=h.data[0].created_time;g.update=(g.data.length>0)?true:false;return g}}})(window);(function(b){var a=b.spotterjs;if(!a){throw new Error("spotter not yet loaded!")}if(!a.modules){a.modules={}}else{if(typeof a.modules!=="object"){throw new Error("spotterjs.modules is not an object!")}}if(!a.modules.flickr){a.modules.flickr={}}else{if(typeof a.modules.flickr!=="object"){throw new Error("spotterjs.modules.flickr is not an object!")}}a.modules.flickr.search=function(e){a.modules.Module.call(this,e);if(e===undefined||e.api_key===undefined||(e.q===undefined&&e.tags===undefined)){throw new Error("flickr search module requires an api_key and a search string (q) or tags to be defined as an option")}var h=e.api_key;var d=e.q;var c=e.tags;var g={id:-1};var f=function(j){var i="http://farm"+j.farm+".static.flickr.com/"+j.server+"/"+j.id+"_"+j.secret+".jpg";return i};this.url=function(){var i="http://api.flickr.com/services/rest/?method=flickr.photos.search";i+="&api_key="+h+"&format=json&content_type=1";if(c!==undefined){i+="&tags="+escape(c)}if(d!==undefined){i+="&text="+escape(d)}return{url:i,callbackParam:"jsoncallback"}};this.process=function(m){var j={};j.data=[];var l=m.photos.photo;var k;for(k=0;k<l.length&&l[k].id!==g.id;k++){l[k].url=f(l[k]);l[k].user_url="http://www.flickr.com/"+l[k].owner;l[k].photo_url="http://www.flickr.com/"+l[k].owner+"/"+l[k].id;j.data.push(l[k])}g=l[0];j.update=(j.data.length>0)?true:false;return j}};a.modules.flickr.feeds=function(d){a.modules.Module.call(this,d);var c=d.tags||null;var e={id:-1};this.url=function(){var f="http://api.flickr.com/services/feeds/photos_public.gne?format=json";if(c!==null){f+="&tags="+escape(c)}return{url:f,callbackParam:"jsoncallback"}};this.process=function(j){var f={};f.data=[];var h=j.items;var g;for(g=0;g<h.length&&h[g].link!==e.link;g++){h[g].url=h[g].media.m.replace("_m","");h[g].user_url="http://www.flickr.com/"+h[g].author_id;h[g].photo_url=h[g].link;h[g].user_id=h[g].author.match(/\(([^\)]*)\)/)[1];f.data.push(h[g])}e=h[0];f.update=(f.data.length>0)?true:false;return f}}})(window);(function(b){var a=b.spotterjs;if(!a){throw new Error("spotterjs not yet loaded!")}if(!a.util){throw new Error("spotterjs.util not yet loaded!")}if(!a.modules){a.modules={}}else{if(typeof a.modules!="object"){throw new Error("spotterjs.modules is not an object!")}}if(!a.modules.identica){a.modules.identica={}}else{if(typeof a.modules.identica!="object"){throw new Error("spotterjs.modules.identica is not an object!")}}a.modules.identica.search=function(e){a.modules.Module.call(this,e);var d="";var c=e.q;var f=0;if(c===undefined||c===""){throw new Error("identica search module requires a search string (q) to be specified as an option")}this.url=function(){var g="http://identi.ca/api/search.json";g+=d!==""?d:"?q="+escape(c);return g};this.process=function(j){var g={};var h;g.data=[];d=j.refresh_url;if(j.results.length>0){g.update=true;for(h=0;h<j.results.length&&j.results[h].id>f;++h){g.data.unshift(j.results[h])}f=j.results[0].id}else{g.update=false}return g}};a.modules.identica.realtimesearch=function(d){a.modules.Module.call(this,d);var c=d.q;var g=0;var f=1000;var e=[0,0,f];if(c===undefined||c===""){throw new Error("identica search module requires searchString to be specified as an option")}this.url=function(){var h="http://identi.ca/api/statuses/public_timeline.json?count="+f;return h};this.process=function(k){var h={};var j;if(g>0){e.push(k[0].id-g);e.shift();f=Math.ceil((e[0]+e[1]+e[2])/3)+10}h.data=[];if(k.length>0){for(j=0;j<k.length&&k[j].id>g;++j){if(k[j].text.match(new RegExp(c,"i"))){h.data.unshift(k[j])}}g=k[0].id;h.update=h.data.length===0?false:true}else{h.update=false}return h}}})(window);(function(b){var a=b.spotterjs;if(!a){throw new Error("spotterjs not yet loaded!")}if(!a.util){throw new Error("spotterjs.util not yet loaded!")}if(!a.modules){a.modules={}}else{if(typeof a.modules!="object"){throw new Error("spotterjs.modules is not an object!")}}if(!a.modules.twitpic){a.modules.twitpic={}}else{if(typeof a.modules.twitpic!="object"){throw new Error("spotterjs.modules.twitpic is not an object!")}}a.modules.twitpic.search=function(e){a.modules.Module.call(this,e);var d="";var c=e.q;if(c===undefined||c===""){throw new Error("twitpic search module requires a search string (q) to be specified as an option")}this.url=function(){var f="http://search.twitter.com/search.json";f+=d!==""?d:"?q="+escape(c)+"+twitpic";return f};this.process=function(k){var g={};var h;var j;var f;d=k.refresh_url||"";g.update=(k.results.length>0)?true:false;g.data=[];for(h=0;h<k.results.length;h++){j=/http\:\/\/twitpic.com\/(\w+)/.exec(k.results[h].text);if(j!==null&&!k.results[h].text.match(new RegExp("^RT"))){f=j[1];k.results[h].twitpic_url="http://twitpic.com/"+f;k.results[h].twitpic_full_url="http://twitpic.com/show/full/"+f;k.results[h].twitpic_thumb_url="http://twitpic.com/show/thumb/"+f;k.results[h].twitpic_mini_url="http://twitpic.com/show/mini/"+f;g.data.push(k.results[h])}}return g}}})(window);(function(b){var a=b.spotterjs;if(!a){throw new Error("spotterjs not yet loaded!")}if(!a.util){throw new Error("spotterjs.util not yet loaded!")}if(!a.modules){a.modules={}}else{if(typeof a.modules!=="object"){throw new Error("spotterjs.modules is not an object!")}}if(!a.modules.twitter){a.modules.twitter={}}else{if(typeof a.modules.twitter!=="object"){throw new Error("spotterjs.modules.twitter is not an object!")}}a.modules.twitter.search=function(f){a.modules.Module.call(this,f);var e="";var d=f.q;var c=(f.exclude!==undefined)?f.exclude.split(","):[];var j=f.lang;var h;var g="";if(d===undefined||d===""){throw new Error("twitter search module requires a search string (q) to be specified as an option")}if(c!==undefined){for(h=0;h<c.length;h++){if(c[h]==="twitpic"||c[h]==="tweetphoto"){g+=(g==="")?c[h]:"|"+c[h]}else{throw new Error(c[h]+" not a valid exclude string, try 'tweetphoto' and/or 'twitpic'")}}}this.url=function(){var i="http://search.twitter.com/search.json";i+=(e!=="")?e:"?q="+escape(d);i+=(j)?"&lang="+j:"";return i};this.process=function(l){var i={};e=l.refresh_url||"";if(g===""){i.data=l.results}else{i.data=[];var k=new RegExp(g);for(h in l.results){if(l.results[h].text.match(k)===null){i.data.push(l.results[h])}else{}}}i.update=(i.data.length>0)?true:false;return i}};a.modules.twitter.trends=function(c){a.modules.Module.call(this,c);var d;this.url=function(){var e="http://api.twitter.com/trends.json?";if(c!==undefined&&c.exclude!==undefined){e+="exclude="+c.exclude}return e};this.process=function(h){var e={};var g=h.trends;if(d===null){e={data:{added:h.trends,removed:{},trends:h.trends}}}else{var f=a.util.complements(h.trends,d);e={data:{added:f[0],removed:f[1],trends:h.trends}}}d=h.trends;e.update=(e.data.added.length>0||e.data.removed.length>0)?true:false;return e}}})(window);