(function(b){var a={};a.Spotter=function(o,s){a.Spotter.instanceCount=(a.Spotter.instanceCount===undefined)?1:a.Spotter.instanceCount+1;var i="_so"+a.Spotter.instanceCount;var t=false;var k=true;var l=null;var j=[];var c=null;var d;var h=[];var q;var r;b.spotterjs[i]=this;if(!a.modules[o.split(".")[0]]||!a.modules[o.split(".")[0]][o.split(".")[1]]){throw new Error("Spotter: Module "+o+" not found! (Did you remember to include it via a script tag?)")}try{d=new (b.spotterjs.modules[o.split(".")[0]][o.split(".")[1]])(s)}catch(m){throw new Error("problem creating "+o+" module -- "+m)}if(!d.url||!d.process){throw new Error("Spotter: spotterjs.modules."+o+" is invalid.  (Does it return an object with url and process methods?)")}var g=function(u){var v=document.getElementsByTagName("head");var e=document.createElement("script");e.id=i+"_request";e.type="text/javascript";e.src=u;if(l){v[0].removeChild(l)}v[0].appendChild(e);l=e};var f=function(u){for(var e in j){if(typeof j[e]==="object"){j[e].notify(u)}else{if(typeof j[e]==="function"){j[e](u)}else{throw new Error("observer list contains an invalid object")}}}};var p=function(){if(h.length>0){r=setTimeout(function(){f(h.pop());p()},2000)}else{clearTimeout(r);r=false}};var n=function(){var e;var u=this;if(k){e=d.url();if(e instanceof Object&&e.callbackParam!==undefined){e=e.url+"&"+e.callbackParam+"=spotterjs."+i+".callback"}else{e+="&callback=spotterjs."+i+".callback"}e+="&random="+Math.floor(Math.random()*10000);g(e)}};this.start=function(){if(!t){t=true;n()}else{throw new Error("Spotter: You can't start a spotter that is already running!")}};this.bufferStart=function(){q=true;this.start()};this.callback=function(v){var e=d.process(v);var u;if(e.update){if(!q){f(e.data)}else{for(u=0;u<e.data.length;u++){h.push(e.data[u])}if(!r){p()}}}k=true;if(d.nextTimeout()>0){c=setTimeout(n,d.nextTimeout()*1000)}else{this.stop()}};this.stop=function(){if(!t){throw new Error("Spotter: You can't stop a stopped spotter!")}else{t=false;var e=document.getElementsByTagName("head");if(l){e[0].removeChild(l)}clearTimeout(c)}};this.register=function(e){if(e!==undefined&&e.notify!==undefined&&typeof e.notify==="function"){j.push(e)}else{if(e!==undefined&&typeof e==="function"){j.push(e)}else{throw new TypeError("Observer must implement a notify method.")}}}};a.util={};a.util.changes=function(e,d){var c=[];var g={};var f;for(f=0;f<d.length;f++){if(!g[d[f]]){g[d[f].name]=parseInt(f,10)}}for(f=0;f<e.length;f++){c[f]=g[e[f].name]===undefined?-1:g[e[f].name]}return c};a.util.complements=function(d,c){var h={};var l=[];var m=[];var g,f,e;for(g=0;g<d.length;g++){if(h[d[g]]===undefined){h[d[g].name]=g}}for(f=0;f<f.length;f++){if(h[c[f].name]===null){m.push(c[f])}else{h[c[f].name]=-1}}for(e in h){if(h[e]>=0){l.push(d[h[e]])}}return[l,m]};a.modules={};a.modules.Module=function(c){var d;if(c.period!==undefined&&typeof(c.period)==="number"){d=c.period}else{d=45}this.nextTimeout=function(e){if(e!==undefined){d=e}else{return d}};this.verifyOptions=function(g,f){var e;for(e=0;e<g.length;e++){if(f[g[e]]===undefined||f[g[e]]===""){throw new Error("this module requires nonempty option "+g[e])}}}};a.verify=function(c){var d;for(d=0;d<c.length;d++){if(!a[c[d]]||(typeof a[c[d]]!=="object"&&typeof a[c[d]]!=="function")){throw new Error(c[d]+" not loaded.  Make sure you load spotter.js before loading any modules.")}}};a.namespace=function(c){if(!a.modules[c]){a.modules[c]={};return a.modules[c]}else{if(typeof a.modules[c]!=="object"){throw new Error("spotterjs.modules."+c+" is not an object!")}}};b.spotterjs=a;b.Spotter=a.Spotter})(window);(function(d,b){var a=d.spotterjs;if(!a||!a.verify){throw new Error("problem with spotter.js file!")}a.verify(["util","modules"]);var c=a.namespace(b);c.recent=function(e){a.modules.Module.call(this,e);var g=function(j,k){for(var h=0;h<k.length;++h){if(k[h].u===j.u){return h}}return k.length};var f;this.url=function(){var h="http://feeds.delicious.com/v2/json/recent/?count=100";return h};this.process=function(k){var h={};var l;if(f===undefined){f=k[0];h={data:k,update:true}}else{if(f.u===k[0].u){h={data:k,update:false}}else{l=k.length-g(f,k);for(var j=0;j<l;j++){k.pop()}h={data:k,update:true};f=k[0]}}return h}};c.tags=function(f){a.modules.Module.call(this,f);var e=f.tags;if(e===undefined||e===""){throw new Error("delicious tags module requires tags to be specified as an option")}var g;var h=function(k,l){for(var j=0;j<l.length;++j){if(l[j].u===k.u){return j}}return l.length};this.url=function(){var i="http://feeds.delicious.com/v2/json/tag/"+e+"?count=100";return i};this.process=function(l){var j={};var m;if(g===undefined){g=l[0];j={data:l,update:true}}else{if(g.u===l[0].u){j={data:l,update:false}}else{m=l.length-h(g,l);for(var k=0;k<m;k++){l.pop()}j={data:l,update:true};g=l[0]}}return j}}})(window,"delicious");(function(d,b){var a=d.spotterjs;if(!a){throw new Error("spotter not yet loaded!")}if(!a||!a.verify){throw new Error("problem with spotter.js file!")}a.verify(["util","modules"]);var c=a.namespace(b);c.search=function(g){a.modules.Module.call(this,g);var f=g.q;var e=null;var h;if(f===undefined||f===""){throw new Error("facebook search module requires a search string (q) to be specified as an option")}this.url=function(){var i="http://graph.facebook.com/search";i+="?q="+escape(f);return i};this.process=function(j){var i={};i.data=[];for(h in j.data){if((e===null||j.data[h].created_time>e)&&j.data[h].type==="status"){j.data[h].profile_image_url="http://graph.facebook.com/"+j.data[h].from.id+"/picture";j.data[h].profile_url="http://www.facebook.com/people/"+j.data[h].from.name.replace(" ","-")+"/"+j.data[h].from.id;i.data.push(j.data[h])}}e=j.data[0].created_time;i.update=(i.data.length>0)?true:false;return i}}})(window,"facebook");(function(d,b){var a=d.spotterjs;if(!a||!a.verify){throw new Error("problem with spotter.js file!")}a.verify(["util","modules"]);var c=a.namespace(b);c.search=function(g){a.modules.Module.call(this,g);if(g===undefined||g.api_key===undefined||(g.q===undefined&&g.tags===undefined)){throw new Error("flickr search module requires an api_key and a search string (q) or tags to be defined as an option")}var j=g.api_key;var f=g.q;var e=g.tags;var i={id:-1};var h=function(l){var k="http://farm"+l.farm+".static.flickr.com/"+l.server+"/"+l.id+"_"+l.secret+".jpg";return k};this.url=function(){var k="http://api.flickr.com/services/rest/?method=flickr.photos.search";k+="&api_key="+j+"&format=json&content_type=1";if(e!==undefined){k+="&tags="+escape(e)}if(f!==undefined){k+="&text="+escape(f)}return{url:k,callbackParam:"jsoncallback"}};this.process=function(n){var k={};k.data=[];var m=n.photos.photo;var l;for(l=0;l<m.length&&m[l].id!==i.id;l++){m[l].url=h(m[l]);m[l].user_url="http://www.flickr.com/"+m[l].owner;m[l].photo_url="http://www.flickr.com/"+m[l].owner+"/"+m[l].id;k.data.push(m[l])}i=m[0];k.update=(k.data.length>0)?true:false;return k}};c.feeds=function(f){a.modules.Module.call(this,f);var e=f.tags||null;var g={id:-1};this.url=function(){var h="http://api.flickr.com/services/feeds/photos_public.gne?format=json";if(e!==null){h+="&tags="+escape(e)}return{url:h,callbackParam:"jsoncallback"}};this.process=function(l){var h={};h.data=[];var k=l.items;var j;for(j=0;j<k.length&&k[j].link!==g.link;j++){k[j].url=k[j].media.m.replace("_m","");k[j].user_url="http://www.flickr.com/"+k[j].author_id;k[j].photo_url=k[j].link;k[j].user_id=k[j].author.match(/\(([^\)]*)\)/)[1];h.data.push(k[j])}g=k[0];h.update=(h.data.length>0)?true:false;return h}}})(window,"flickr");(function(d,b){var a=d.spotterjs;if(!a||!a.verify){throw new Error("problem with spotter.js file!")}a.verify(["util","modules"]);var c=a.namespace(b);c.search=function(g){a.modules.Module.call(this,g);var f="";var e=g.q;var h=0;if(e===undefined||e===""){throw new Error("identica search module requires a search string (q) to be specified as an option")}this.url=function(){var i="http://identi.ca/api/search.json";i+=f!==""?f:"?q="+escape(e);return i};this.process=function(l){var j={};var k;j.data=[];f=l.refresh_url;if(l.results.length>0){j.update=true;for(k=0;k<l.results.length&&l.results[k].id>h;++k){j.data.unshift(l.results[k])}h=l.results[0].id}else{j.update=false}return j}};c.realtimesearch=function(f){a.modules.Module.call(this,f);var e=f.q;var i=0;var h=1000;var g=[0,0,h];if(e===undefined||e===""){throw new Error("identica search module requires searchString to be specified as an option")}this.url=function(){var j="http://identi.ca/api/statuses/public_timeline.json?count="+h;return j};this.process=function(l){var j={};var k;if(i>0){g.push(l[0].id-i);g.shift();h=Math.ceil((g[0]+g[1]+g[2])/3)+10}j.data=[];if(l.length>0){for(k=0;k<l.length&&l[k].id>i;++k){if(l[k].text.match(new RegExp(e,"i"))){j.data.unshift(l[k])}}i=l[0].id;j.update=j.data.length===0?false:true}else{j.update=false}return j}}})(window,"identica");(function(d,b){var a=d.spotterjs;if(!a||!a.verify){throw new Error("problem with spotter.js file!")}a.verify(["util","modules"]);var c=a.namespace(b);c.search=function(g){a.modules.Module.call(this,g);var f="";var e=g.q;if(e===undefined||e===""){throw new Error("twitpic search module requires a search string (q) to be specified as an option")}this.url=function(){var h="http://search.twitter.com/search.json";h+=f!==""?f:"?q="+escape(e)+"+twitpic";return h};this.process=function(m){var j={};var k;var l;var h;f=m.refresh_url||"";j.update=(m.results.length>0)?true:false;j.data=[];for(k=0;k<m.results.length;k++){l=/http\:\/\/twitpic.com\/(\w+)/.exec(m.results[k].text);if(l!==null&&!m.results[k].text.match(new RegExp("^RT"))){h=l[1];m.results[k].twitpic_url="http://twitpic.com/"+h;m.results[k].twitpic_full_url="http://twitpic.com/show/full/"+h;m.results[k].twitpic_thumb_url="http://twitpic.com/show/thumb/"+h;m.results[k].twitpic_mini_url="http://twitpic.com/show/mini/"+h;j.data.push(m.results[k])}}return j}}})(window,"twitpic");(function(d,b){var a=d.spotterjs;if(!a||!a.verify){throw new Error("problem with spotter.js file!")}a.verify(["util","modules"]);var c=a.namespace(b);c.search=function(h){a.modules.Module.call(this,h);var g="";var f=h.q;var e=(h.exclude!==undefined)?h.exclude.split(","):[];var m=h.lang;var k;var j="";var l="";this.verifyOptions(["q"],h);if(e!==undefined){for(k=0;k<e.length;k++){if(e[k]==="twitpic"||e[k]==="tweetphoto"){j+=(j==="")?e[k]:"|"+e[k]}else{throw new Error(e[k]+" not a valid exclude string, try 'tweetphoto' and/or 'twitpic'")}}}this.baseURL=function(i){if(i&&typeof i==="string"){l=i}else{return l}};this.baseURL("http://search.twitter.com/search.json");this.url=function(){var i=this.baseURL();i+=(g!=="")?g:"?q="+escape(f);i+=(m)?"&lang="+m:"";return i};this.process=function(o){var i={};g=o.refresh_url||"";if(j===""){i.data=o.results}else{i.data=[];var n=new RegExp(j);for(k in o.results){if(o.results[k].text.match(n)===null){i.data.push(o.results[k])}}}i.update=(i.data.length>0)?true:false;return i}};c.trends=function(e){a.modules.Module.call(this,e);var f;this.url=function(){var g="http://api.twitter.com/trends.json?";if(e!==undefined&&e.exclude!==undefined){g+="exclude="+e.exclude}return g};this.process=function(j){var g={};var i=j.trends;if(f===null){g={data:{added:j.trends,removed:{},trends:j.trends}}}else{var h=a.util.complements(j.trends,f);g={data:{added:h[0],removed:h[1],trends:j.trends}}}f=j.trends;g.update=(g.data.added.length>0||g.data.removed.length>0)?true:false;return g}}})(window,"twitter");